<script>
    const startBtn = document.getElementById('start-btn');
    const pauseBtn = document.getElementById('pause-btn');
    const gif = document.getElementById('gif');
    const musica = document.getElementById('musica');
    const foto = document.getElementById('foto');
    const mensagensDiv = document.getElementById('mensagens');
    const body = document.body;

    let frases = [
        "Você é incrível!",
        "Mais um ano de conquistas!",
        "Desejamos tudo de bom!",
        "Parabéns pelo seu dia!"
    ];
    let fraseIndex = 0;
    let fraseInterval = null;
    let isPaused = false;
    let gifDisplayed = false; // Controla se o gif já foi exibido após 59 segundos
    let gifPosition = 'left'; // Controle da posição do gif (esquerda, direita, cima, baixo)

    startBtn.addEventListener('click', () => {
        musica.currentTime = 0;
        musica.play();
        foto.style.display = 'block';
        startBtn.style.display = 'none';
        pauseBtn.style.display = 'inline-block';
        exibirMensagens();
        explodirConfetes();
        gifDisplayed = false; // Reseta o controle do gif

        setTimeout(() => {
            // Após 59 segundos, o gif pode ser exibido
            if (musica.paused === false && musica.currentTime >= 59) {
                gif.style.display = 'block';
                gifPosition = 'left'; // Inicialmente no lado esquerdo
                gif.style.left = '10%';
                gif.style.top = '50%';
                gif.style.transform = 'translateY(-50%)'; // Mantém o GIF centralizado verticalmente
                gifDisplayed = true;
                moverGif();
            }
        }, 59000);
    });

    pauseBtn.addEventListener('click', () => {
        if (isPaused) {
            musica.play();
            // Só exibe o gif se a música já passou de 59 segundos
            if (musica.currentTime >= 59) {
                gif.style.display = 'block';
                moverGif(); // Resume o movimento do GIF
            }
            pauseBtn.textContent = "Pause";
        } else {
            musica.pause();
            clearInterval(fraseInterval);
            gif.style.display = 'none'; // Esconde o gif quando a música é pausada
            pauseBtn.textContent = "Play";
        }
        isPaused = !isPaused;
    });

    musica.addEventListener('timeupdate', () => {
        // Só exibe o gif depois que a música alcançar 59 segundos
        if (musica.currentTime >= 59 && !gifDisplayed && !musica.paused) {
            gif.style.display = 'block';
            gifPosition = 'left'; // Inicialmente no lado esquerdo
            gif.style.left = '10%';
            gif.style.top = '50%';
            gif.style.transform = 'translateY(-50%)'; // Mantém o GIF centralizado verticalmente
            gifDisplayed = true;
            moverGif();
        } else if (musica.paused) {
            gif.style.display = 'none'; // Esconde o gif quando a música for pausada
        }
    });

    function moverGif() {
        setTimeout(() => {
            if (musica.paused) return; // Respeita a pausa da música
            // Move o GIF para o lado direito após 600ms
            gif.style.left = '80%'; // Agora mais próximo da foto
            gif.style.transform = 'translateY(-50%) scaleX(-1)'; // Espelha o GIF
            gifPosition = 'right';

            // Após 600ms, sobe o GIF
            setTimeout(() => {
                if (musica.paused) return;
                gif.style.left = '50%'; // Centraliza horizontalmente
                gif.style.top = '10%'; // Sobe o GIF
                gif.style.transform = 'translateX(-50%)'; // Centraliza horizontalmente
                gifPosition = 'top';

                // Após 600ms, desce o GIF
                setTimeout(() => {
                    if (musica.paused) return;
                    gif.style.top = '80%'; // Desce o GIF
                    gifPosition = 'bottom';
                }, 600); // Tempo de 600ms para o GIF ir de cima para baixo
            }, 600); // Tempo de 600ms para o GIF mover para a direita
        }, 600); // Tempo de 600ms para o GIF mover para a direita
    }

    function exibirMensagens() {
        fraseInterval = setInterval(() => {
            if (fraseIndex < frases.length) {
                const novaMensagem = document.createElement('p');
                novaMensagem.textContent = frases[fraseIndex];
                mensagensDiv.appendChild(novaMensagem);
                fraseIndex++;
            } else {
                clearInterval(fraseInterval);
            }
        }, 3000);
    }

    function explodirConfetes() {
        const numConfetes = 400;
        const duracao = 4000;

        for (let i = 0; i < numConfetes; i++) {
            const confetti = document.createElement('div');
            confetti.classList.add('confetti');

            const isLeft = Math.random() < 0.5;
            confetti.style.left = isLeft ? '0%' : '100%';
            confetti.style.top = '0%';

            confetti.style.setProperty('--dx', `${Math.random() * (isLeft ? 1 : -1)}`);
            confetti.style.setProperty('--dy', `${Math.random() * 2}`);
            confetti.style.backgroundColor = `hsl(${Math.random() * 360}, 100%, 70%)`;

            body.appendChild(confetti);

            setTimeout(() => {
                confetti.style.animation = `confettiExplode ${duracao / 1000}s ease-out forwards`;
            }, 0);

            setTimeout(() => {
                confetti.remove();
            }, duracao);
        }
    }
</script>
